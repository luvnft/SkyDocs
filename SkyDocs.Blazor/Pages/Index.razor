@page "/"

<Modal @ref="modalRef" Closing="@OnModalClosing">
    <ModalContent Size="@modalSize" Centered="@centered">
        <ModalHeader>
            <ModalTitle>
                <Icon Name="IconName.User" />
                Login
            </ModalTitle>
            @*<CloseButton Clicked="@HideModal" />*@
        </ModalHeader>
        <ModalBody>
            <Validations Mode="ValidationMode.Auto" ValidateOnLoad="false">
                <Validation Validator="@ValidationRule.IsNotEmpty">
                    <Field>
                        <FieldLabel>Username</FieldLabel>
                        <TextEdit Placeholder="Username" @bind-Text="@Username" KeyUp="@OnTextChanged">
                            <Feedback>
                                <ValidationError>Please enter a username</ValidationError>
                            </Feedback>
                        </TextEdit>
                    </Field>
                </Validation>
                <Validation Validator="@ValidationRule.IsNotEmpty">
                    <Field>
                        <FieldLabel>Password</FieldLabel>
                        <TextEdit Placeholder="Password" Role="TextRole.Password" @bind-Text="@Password" KeyUp="@OnTextChanged">
                            <Feedback>
                                <ValidationError>Please enter a password</ValidationError>
                            </Feedback>
                        </TextEdit>
                    </Field>
                </Validation>
            </Validations>
            <br />
            <p>
                <small>
                    You can enter any username / password combination. But please remember your username and password, there is no way to retreive them.
                </small>
                <br />
                <small>NOTE: all data is publicly stored on Sia Skynet.</small>
            </p>
        </ModalBody>
        <ModalFooter>
            <Button Color="Color.Primary" Clicked="@Login" Disabled="@LoginDisabled">Login</Button>
        </ModalFooter>
    </ModalContent>
</Modal>

<Modal Visible="skyDocsService.IsLoading" Closing="@OnLoadingModalClosing">
    <ModalContent>
        <ModalHeader>
            <ModalTitle>
                <Icon Name="IconName.FileDownload" />
                Loading documents from SkyNet...
            </ModalTitle>
        </ModalHeader>
        <ModalBody>
            <div class="loader">
                Loading...
            </div>
        </ModalBody>
    </ModalContent>
</Modal>

<Modal Visible="IsSaving" Closing="@OnSavingModalClosing">
    <ModalContent>
        <ModalHeader>
            <ModalTitle>
                <Icon Name="IconName.FileUpload" />
                Saving document to Skynet...
            </ModalTitle>
        </ModalHeader>
        <ModalBody>
            <div class="loader">
                Saving...
            </div>
        </ModalBody>
    </ModalContent>
</Modal>

<Modal Visible="!string.IsNullOrEmpty(skyDocsService.Error)" Closing="@OnErrorModalClosing">
    <ModalContent>
        <ModalHeader>
            <ModalTitle>
                <Icon Name="IconName.Exclamation" />
                Error
            </ModalTitle>
        </ModalHeader>
        <ModalBody>
            @skyDocsService.Error
        </ModalBody>
    </ModalContent>
</Modal>

@if (skyDocsService.IsLoggedIn && skyDocsService.CurrentDocument == null && !skyDocsService.IsLoading)
{
    <Row>
        <Column ColumnSize="ColumnSize.Is4.OnTablet.Is3.OnWidescreen.Is12.OnMobile">
            <Card Margin="Margin.Is4.OnY">
                <CardBody>
                    <CardTitle Size="5">New Document</CardTitle>
                    <Button Color="Color.Primary" Clicked="@NewDocument">Blank</Button>

                    @*@if (!skyDocsService.DocumentList.Any(x => x.Id == Guid.Parse("4c17a20d-8aa0-42b2-b7cd-d2f03d0be2f9")))
                        {
                            <Button Color="Color.Secondary" Clicked="@AddTemplates">Add templates</Button>
                        }*@
                </CardBody>
            </Card>
        </Column>

        @foreach (var document in skyDocsService.DocumentList.OrderByDescending(x => x.ModifiedDate))
        {
            <Column ColumnSize="ColumnSize.Is4.OnTablet.Is3.OnWidescreen.Is12.OnMobile">
                <Card Margin="Margin.Is4.OnY" @onclick="@(x => OpenDocument(document.Id))">
                    @if (document.PreviewImage != null)
                    {
                        <CardImage Source="@string.Format("https://siasky.net/{0}", document.PreviewImage)" Style="width:100%;height:auto" Alt="@document.Title">
                        </CardImage>
                    }

                    <CardBody>
                        <CardTitle Size="5">@document.Title</CardTitle>
                        <CardLink>Edit</CardLink>
                    </CardBody>
                </Card>
            </Column>
        }
    </Row>
}
else if (skyDocsService.CurrentDocument != null)
{
    <TextEdit Placeholder="Title" @bind-Text="@skyDocsService.CurrentDocument.Title" />

    <RadzenHtmlEditor @bind-Value=@DocumentSource
                      id="rte"
                      Visible="DocumentSource != null"
                      style="height: 500px; margin-bottom: 1rem;" />
}





@if (skyDocsService.CurrentDocument != null)
{
    <Button Class="btn-icon" Size="Size.ExtraSmall" Clicked="@OnDelete"><Icon Name="IconName.Delete" /></Button>
    <Button Class="btn-icon" Size="Size.ExtraSmall" Clicked="@OnSave"><Icon Name="IconName.Save" /></Button>

    <div style="text-align:right" id="test">
        <Button Color="Color.Danger" Clicked="@GoToList">Back</Button>
        <Button Color="Color.Success" Clicked="@OnSave">Save</Button>
    </div>
}